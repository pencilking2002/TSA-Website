jQuery(document).ready(function(a){function n(){if(b.length){var i=b.width(),j=0,l={};h=b.offset().left;g=h+i;d.makeTabVisible(h,g,c,k,m);if(e.last().isTabVisible(h,g)){j=b.width()-f;j=j>0?0:j;l[k]=j+"px";c.animate(l,100,"linear")}if(i>f)a(".nav-tabs-arrow-right, .nav-tabs-arrow-left").hide();else a(".nav-tabs-arrow-right, .nav-tabs-arrow-left").show()}}a(".addOption").live("click",function(b){var c=a(this).parent().parent().find(".clonedOption").length;var d=c+1;var e=a(this).closest("div").attr("id");var f=a(this).closest("div").children("label").attr("for");var g=f.replace(new RegExp(/(\d+)$/g),"");var h=e.replace(new RegExp(/(\d+)$/g),"");var i=a("#"+e).clone().attr("id",h+d);i.children("label").attr("for",g+d);i.find("input").attr("id",g+d);a("#"+h+c).after(i);return false});a(".deleteOption").live("click",function(){var b=a(this).parent().parent().find(".clonedOption").length;if(b-1==0){alert("You must have at least one option.")}else{a(this).closest("div").remove()}return false});a(".addEmail").live("click",function(b){var c=a(this).parent().parent().find(".clonedOption").length;var d=c+1;var e=a(this).closest("div").attr("id");var f=a(this).closest("div").children("label").attr("for");var g=f.replace(new RegExp(/(\d+)$/g),"");var h=e.replace(new RegExp(/(\d+)$/g),"");var i=a("#"+e).clone().attr("id",h+d);i.children("label").attr("for",g+d);i.find("input").attr("id",g+d);a("#"+h+c).after(i);return false});a(".deleteEmail").live("click",function(){var b=a(this).parent().parent().find(".clonedOption").length;if(b-1==0){alert("You must have at least one option.")}else{a(this).closest("div").remove()}return false});a(".menu-delete, .entry-delete").click(function(){var b=a(this).hasClass("entry-delete")?"entry":"form";var c=confirm("You are about to permanently delete this "+b+" and all of its data.\n'Cancel' to stop, 'OK' to delete.");if(c)return;return false});a(".item-edit").live("click",function(b){a(b.target).closest("li").children(".menu-item-settings").slideToggle("fast");a(this).toggleClass("opened");return false});a("#form-copy-to-clipboard").focus(function(){this.select()});var b=a(".nav-tabs-wrapper"),c=b.children(".nav-tabs"),d=c.children(".nav-tab-active"),e=c.children(".nav-tab"),f=0,g,h,i={},j,k="margin-left",l="margin-right",m=2;e.each(function(){f+=a(this).outerWidth(true)});i["padding"]=0;i[l]=-1*f+"px";c.css(i);n();a(window).resize(function(){if(j)clearTimeout(j);j=setTimeout(n,200)});a(".nav-tabs-arrow-right").mousedown(function(){var a=Math.abs(parseInt(c.css(k))),d=a,e={};d=Math.abs(f-b.width())-a;if(!d)return;e[k]="-="+d+"px";c.animate(e,d*m,"linear")}).mouseup(function(){c.stop(true)});a(".nav-tabs-arrow-left").mousedown(function(){var a=Math.abs(parseInt(c.css(k))),b=a,d={};if(!b)return;d[k]="+="+b+"px";c.animate(d,b*m,"linear")}).mouseup(function(){c.stop(true)});a("#menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".menu-item-handle",placeholder:"sortable-placeholder",tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(b,c){a(this).css("min-height",a(this).height())},start:function(a,b){b.placeholder.height(b.item.height())},stop:function(b,c){opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_process_sort",order:a(this).nestedSortable("toArray")},success:function(b){a("#loading-animation").hide();return}};a.ajax(opts)}});a('#form-items input[type="submit"]').click(function(){a(this).closest("form").data("submit_value",a(this))});a("#form-items").live("submit",function(b){b.preventDefault();var c=a(this).serializeArray(),d=a(this).data("submit_value").attr("value");a("img.waiting").show();a.ajax({url:ajaxurl,type:"GET",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",data:c,field_type:d,page:pagenow,nonce:a("#_wpnonce").val()},success:function(b){a("img.waiting").hide();a(b).hide().insertBefore("#menu-to-edit li.ui-state-disabled").fadeIn();return},error:function(a,b,c){alert("There was an error loading the content");return}})});a(".item-delete").live("click",function(b){b.preventDefault();var c=childs=new Array,d=0,e=a(this).attr("href"),f=e.split("&");for(var g=0;g<f.length;g++){var h=f[g].indexOf("=");var i=f[g].substring(0,h);var j=f[g].substring(h+1);c[i]=j}var k=a(this).closest(".form-item").find("ul").children();var l=k.parent().html();k.each(function(b){childs[b]=a(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var m=a(this).closest("li.form-item").parents("li.form-item");if(m.length)d=m.attr("id").match(new RegExp(/(\d+)$/g))[0];console.log(d);a.ajax({url:ajaxurl,type:"GET",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_delete_field",form:c["form"],field:c["field"],child_ids:childs,parent_id:d,page:pagenow,nonce:c["_wpnonce"]},success:function(b){a("#form_item_"+c["field"]).addClass("deleting").animate({opacity:0,height:0},350,function(){a(this).before(l).remove()});return},error:function(a,b,c){alert("There was an error loading the content");return}})});var o=a(".form-success-type:checked").val();a("#form-success-message-"+o).show();a(".form-success-type").change(function(){var b=a(this).val();if("text"==b){a("#form-success-message-text").show();a("#form-success-message-page, #form-success-message-redirect").hide()}else if("page"==b){a("#form-success-message-page").show();a("#form-success-message-text, #form-success-message-redirect").hide()}else if("redirect"==b){a("#form-success-message-redirect").show();a("#form-success-message-text, #form-success-message-page").hide()}});a("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(b){return a("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(b){return a("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(b){return a("#form-notification-setting").is(":checked")}}},errorPlacement:function(a,b){a.insertAfter(b.parent())}});a("#form_email_from_name_override").change(function(){if(a("#form_email_from_name_override").val()==""){a("#form-email-sender-name").attr("readonly",false)}else{a("#form-email-sender-name").attr("readonly","readonly")}});a("#form_email_from_override").change(function(){if(a("#form_email_from_override").val()==""){a("#form-email-sender").attr("readonly",false)}else{a("#form-email-sender").attr("readonly","readonly")}});if(a("#form-notification-setting").is(":checked")){a("#notification-email").show()}else{a("#notification-email").hide()}a("#form-notification-setting").change(function(){var b=a(this).is(":checked");if(b){a("#notification-email").show();a("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled",false)}else{a("#notification-email").hide();a("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled","disabled")}});a.validator.addMethod("multiemail",function(a,b){if(this.optional(b))return true;var c=a.split(new RegExp("\\s*[,|;]\\s*","gi"));valid=true;for(var d in c){a=c[d];valid=valid&&jQuery.validator.methods.email.call(this,a,b)}return valid},"One or more email addresses are invalid")});jQuery.fn.extend({makeTabVisible:function(a,b,c,d,e){var f=this.eq(0),g,h,i={},j=0;if(!f.length)return this;g=f.offset().left;h=g+f.outerWidth();if(h>b)j=b-h;else if(g<a)j=a-g;if(!j)return this;i[d]="+="+1*j+"px";c.animate(i,Math.abs(j)*e,"linear");return this},isTabVisible:function(a,b){var c=this.eq(0),d=c.offset().left,e=d+c.outerWidth();return e<=b&&d>=a?true:false}})